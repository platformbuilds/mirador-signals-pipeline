global
    log stdout format raw local0
    maxconn 4096
    stats timeout 30s

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

# HAProxy Stats Page
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /
    stats refresh 10s
    stats auth admin:admin

# OTLP gRPC Gateway Load Balancer
frontend otlp_grpc_frontend
    bind *:4317
    mode tcp
    default_backend otlp_grpc_backend

backend otlp_grpc_backend
    mode tcp
    balance roundrobin
    # Single node (will be expanded for multi-node)
    server node1 gateway:4317

# OTLP HTTP Gateway Load Balancer
frontend otlp_http_frontend
    bind *:4318
    mode http
    default_backend otlp_http_backend

backend otlp_http_backend
    mode http
    balance roundrobin
    # Single node (will be expanded for multi-node)
    server node1 gateway:4318

# VictoriaMetrics Query (vmselect)
frontend vm_query_frontend
    bind *:8481
    mode http
    default_backend vm_query_backend

backend vm_query_backend
    mode http
    balance roundrobin
    option httpchk GET /health
    server node1 vmselect:8481 check

# VictoriaMetrics Insert (vminsert)
frontend vm_insert_frontend
    bind *:8480
    mode http
    default_backend vm_insert_backend

backend vm_insert_backend
    mode http
    balance roundrobin
    option httpchk GET /health
    server node1 vminsert:8480 check

# VictoriaTraces Query (vtselect)
frontend vt_query_frontend
    bind *:8483
    mode http
    default_backend vt_query_backend

backend vt_query_backend
    mode http
    balance roundrobin
    option httpchk GET /health
    server node1 vtselect:8481 check

# VictoriaTraces Insert (vtinsert) - OTLP
frontend vt_insert_frontend
    bind *:4327
    mode tcp
    default_backend vt_insert_backend

backend vt_insert_backend
    mode tcp
    balance roundrobin
    server node1 vtinsert:4317

# VictoriaLogs Query (vlselect)
frontend vl_query_frontend
    bind *:9471
    mode http
    default_backend vl_query_backend

backend vl_query_backend
    mode http
    balance roundrobin
    option httpchk GET /health
    server node1 vlselect:9471 check

# VictoriaLogs Insert (vlinsert)
frontend vl_insert_frontend
    bind *:8429
    mode http
    default_backend vl_insert_backend

backend vl_insert_backend
    mode http
    balance roundrobin
    option httpchk GET /health
    server node1 vlinsert:8429 check

# Gateway Metrics (Prometheus)
frontend gateway_metrics_frontend
    bind *:8888
    mode http
    default_backend gateway_metrics_backend

backend gateway_metrics_backend
    mode http
    balance roundrobin
    server node1 gateway:8888 check
